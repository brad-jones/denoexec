on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

env:
  CI: true

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2.3.4

      - name: Install asdf tool version manager
        uses: asdf-vm/actions/install@v1.1.0

      - name: Update all the things
        run: task update

      - name: Authenticate as the denoexec bot
        id: generate_token
        uses: tibdex/github-app-token@v1.3.0
        with:
          app_id: ${{ secrets.BOT_ID }}
          private_key: ${{ secrets.BOT_KEY }}

      - name: Create a PR with the updates
        uses: peter-evans/create-pull-request@v3.10.0
        with:
          title: "fix(deps): bump versions of all that we depend on"
          body: "Automated changes by https://github.com/peter-evans/create-pull-request"
          branch: dependencies/all-the-things
          delete-branch: true
          labels: dependencies
          token: ${{ steps.generate_token.outputs.token }}
